---
title: "Kaggle Titanic Analysis"
author: "Sondra Hoffman"
date: "10/24/2023"
output: 
  html_document:
    theme: cerulean
    highlight: espresso
    toc: TRUE
    toc_depth: 2
    toc_float: TRUE
    df_print: paged
  
---

# Introduction

This R Markdown document provides an analysis of the Titanic dataset from the Kaggle competition. The goal is to predict passenger survival based on various features. This document combines code, visualizations, and explanations to walk through the analysis.

# Dataset Description

## Overview

This dataset contains information about passengers aboard the Titanic, including their demographic details, ticket information, and survival status. It's divided into two main files: 'train.csv' and 'test.csv'. 

## Files

* 'train.csv': This file contains data for training machine learning models. It includes columns 'PassengerID', 'Survived', 'Pclass', 'Name', 'Sex', 'Age', 'SibSp', 'Parch', 'Ticket', 'Fare', 'Cabin', and 'Embarked'.

* 'test.csv': This file is used for making predictions. It has the same structure as 'train.csv', except it lacks the 'Survived' column. 

## Columns

Here is a brief explanation of the important columns: 

* **PassengerId:** Unique identifier for passenger
* **Survived:** Survival - 0 = No, 1 = Yes
* **Pclass:** Ticket class - 1 = 1st, 2 = 2nd, 3 = 3rd; A proxy for socio-economic   status (SES)
* **Name:** Full name of passenger
* **Sex:** Gender of the passenger
* **Age:** Age of passenger, Age is fractional if less than 1. If the age is estimated, is it in the form of xx.5.
* **SibSp:** # of siblings / spouses aboard the Titanic, The dataset defines family relations in this way: Sibling = brother, sister, stepbrother, stepsister Spouse = husband, wife (mistresses and fianc√©s were ignored)
* **Parch:** # of parents / children aboard the Titanic,The dataset defines family relations in this way: Parent = mother, father Child = daughter, son, stepdaughter, stepson. Some children traveled only with a nanny, therefore parch=0 for them.
* **Ticket:** Ticket number
* **Fare:** Cost of ticket
* **Cabin:** Cabin number.
* **Embarked:** C = Cherbourg, Q = Queenstown, S = Southampton

# Load Packages

```{r load-packages, echo=TRUE}

library(readr)
library(tidyverse)
library(ggplot2)
library(glmnet)

```

# Data Preparation

In this section, the data is loaded and processed for analysis.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

train1 <- read_csv("/home/sondrahoffman/Documents/R_Examples/TitanicSurvivalAnalysis/TrainDataSet/TitanicSurvivalTrainData.csv")

test <- read_csv("/home/sondrahoffman/Documents/R_Examples/TitanicSurvivalAnalysis/TestDataSet/TitanicSurvivalTestData.csv")
```

## Explore Data Structure

In this section, the structure of the data is inspected. The variable types are identified and the basic formatting is reviewed. There are differences in the data structure of the two datasets. 


```{r data_structure, include=TRUE}

str(train1)
str(test)

```

## Handle Missing Data

Below the missing data is filled using a top to bottom approach. 

```{r missing_data, include=TRUE}
train1 <- train1  %>% 
  fill(Age,Embarked, .direction = "down")
train1
summary(train1)

test <- test  %>% 
  fill(Age,Embarked, .direction = "down")
train1
summary(train1)
```

## Encode Categorical Variables

This section encodes categorical variables as factors. Notice in the Explore Data Structure output that these variable types were initially col_double. Factors are a better choice for this analysis. 

```{r encoding, echo=TRUE, max.print= 7}

factor(train1$Survived) 
train1$Survived <- factor(train1$Survived)

factor(train1$Pclass) 
train1$Pclass <- factor(train1$Pclass)

factor(test$Pclass)
test$Pclass <- factor(test$Pclass)

factor(train1$Name)
train1$Name <- factor(train1$Name)

factor(test$Name) 
test$Name <- factor(test$Name)

factor(train1$Sex)
train1$Sex <- factor(train1$Sex)

factor(test$Sex)
test$Sex <- factor(test$Sex)

factor(train1$Ticket)
train1$Ticket <- factor(train1$Ticket)

factor(test$Ticket)
test$Ticket <- factor(test$Ticket)

factor(train1$Cabin) 
train1$Cabin <- factor(train1$Cabin)

factor(test$Cabin)
test$Cabin <- factor(test$Cabin)

factor(train1$Embarked) 
train1$Embarked <- factor(train1$Embarked)

factor(test$Embarked) 
test$Embarked <- factor(test$Embarked)
```

## Feature Engineering

Separates the Name column into three separate columns to isolate the prefix variable.

```{r prefix_variable, include=TRUE, max.print= 7}

as_tibble(train1)
train1 <- train1 %>%
  separate(Name, into = c("LastName","Prefix","FirstName"), sep = "[,.]")
train1
summary(train1)

as_tibble(test)
test <- test %>%
  separate(Name, into = c("LastName","Prefix","FirstName"), sep = "[,.]")
test
summary(test)

factor(train1$Prefix) 
train1$Prefix <- factor (train1$Prefix)

factor(test$Prefix)  
test$Prefix <- factor (test$Prefix)

summary(train1)
summary(test)
```

Creates a new version of the dataset that contains binary fields for 'HasCabin' and 'Gender'. 

```{r gender,include = TRUE, max.print= 7}
as_tibble(train1)#created data structure for exploratory analysis.  
train1 <-train1 %>%
  mutate(HasCabin = ifelse(is.na(Cabin),0,1)) %>%# 1 = yes, 0 = no. 
  mutate(Gender = ifelse(Sex == "female",1,0))%>% # 1 = female, 0 = male. 
  select(PassengerId,Survived,Pclass,Prefix,Sex,Gender,Age,SibSp,Parch,
         Fare,HasCabin,Embarked)
train1
summary(train1)

as_tibble(test)#created data structure for exploratory analysis.  
test <-test %>%
  mutate(HasCabin = ifelse(is.na(Cabin),0,1)) %>%# 1 = yes, 0 = no. 
  mutate(Gender = ifelse(Sex == "female",1,0))%>% # 1 = female, 0 = male. 
  select(PassengerId,Pclass,Prefix,Sex,Gender,Age,SibSp,Parch,
        Fare,HasCabin,Embarked)
test
summary(test)
```


# Exploratory Analysis
This section's data has a bimodal distribution that is right skewed and complicates the interpretation of central tendencies. Traditional statistical tests assume a normal distribution. 

## Survival by Gender

```{r survival_by_gender, echo=FALSE}
ggplot(train1, aes(x = Gender ))+ #Density plot showing survival based on Gender. 
  geom_density(aes(fill = Survived), 
               position = "stack")+
  labs(x = "Gender",
       y = "Density",
       title = "Density Plot",
       subtitle = "Survival Based on Gender",
       caption = "Data follows a bimodal distribution that is right skewed.")

ggplot(data = train1)+ #Visual for survivors based on gender. 
  geom_bar(mapping = aes(x= Sex, fill = Survived), color = 'black')+
  labs(x = "Gender", 
       y = "Count of Passengers", 
       title = "Bar Graph of Survivors", 
       subtitle = "Based on Gender",
       caption = "This bar graph of survivors shows that more women survived than men in general.")+
  theme_minimal()

summary_gender <- train1 %>%  # Summarizes the total number of men and women that survived with the survival ratio. Men = 0, Women = 1; Survived 0 = No, 1 = Yes
  group_by(Gender,Survived)%>%
  summarise(count=n())%>%
  mutate(ratio = count/sum(count))

summary_gender

ggplot(summary_gender, aes(x = as.factor(Gender),y = count, fill = as.factor(Survived)))+
  geom_bar(stat = "identity", position = "dodge")+
  geom_text(aes(label = sprintf("%.2f", ratio * 100)),vjust = -0.5,position = position_dodge(0.9))+
  labs(
    title = "Breakdown and Ratio of Gender by Survived",
    x = "Gender",
    y = "Count",
    fill = "Survived",
    caption = "This breakdown shows that more women survived even when compared to the survival ratios."
  )+
  theme_minimal()
```

## Survival by Passenger Class

```{r passenger_class, echo=FALSE}

ggplot(train1, aes(x = Pclass ))+ #Density plot showing survival based on Passenger Class. 
  geom_density(aes(fill = Survived), 
               position = "stack")+
  labs(x = "Passenger Class",
       y = "Density",
       title = "Density Plot",
       subtitle = "Survival Based on Age",
       caption = "Data does not follow a normal distribution and is right skewed")+
  theme_minimal()

ggplot(data = train1)+ #Visual of survivors based on class. 
  geom_bar(mapping = aes(x = Pclass, 
                         fill = Survived),color = "black")+
  labs(x = "Passenger Class", 
       y = "Count of Passengers", 
       title = "Bar Graph of Survivors", 
       subtitle = "Based on Class",
       caption = "First class passengers had the most survivors while third class passengers suffered the most casualties.")+
  theme_minimal()

summary_class <- train1 %>%  # Summarizes the passengers by class that survived with the survival ratio. Survived 0 = No, 1 = Yes
  group_by(Pclass,Survived)%>%
  summarise(count=n())%>%
  mutate(ratio = count/sum(count))

summary_class

ggplot(summary_class, aes(x = as.factor(Pclass),y = count, fill = as.factor(Survived)))+
  geom_bar(stat = "identity", position = "dodge")+
  geom_text(aes(label = sprintf("%.2f", ratio * 100)),vjust = -0.5,position = position_dodge(0.9))+
  labs(
    title = "Breakdown and Ratio of Class by Survived",
    x = "Passenger Class",
    y = "Count",
    fill = "Survived",
    caption = "This breakdown shows that more first class passengers survived even when compared to the survival ratios." )+
  theme_minimal()
```

## Survival by Age

Adults between the ages of 20 and 30 had the largest number of survivors, but also a significant amount of casualties. Survival odds dramatically declined for people older than 50. In addition,  more men died overall than women across all classes. Small children in first and second class had better survival rates compared to the other classes. Slightly more children survived than died. Women of the second class survived better than the men, but there were fewer second class passengers on board overall. Third class had the worst outcomes.

```{r Age_Analysis, echo=FALSE}

ggplot(data = train1, aes(x = factor(Survived), y = Age, fill = factor(Survived))) +  
  geom_boxplot() +
  labs(x = "Survived", 
       y = "Age", 
       title = "Survial Box Plot",
       subtitle = "Based on Age",
       caption = "Box plot shows there are a few outliers in the age of survivors and causualties over 65.") +
  scale_fill_discrete(name = "Survived") +
  theme_minimal()

ggplot(train1, aes(x = Age ))+ #Density plot showing survival based on Age. 
  geom_density(aes(fill = Survived), 
               position = "stack")+
  labs(x = "Age",
       y = "Density",
       title = "Density Plot",
       subtitle = "Survival Based on Age",
       caption = "Data does not follow a normal distribution and is right skewed.")+
  theme_minimal()

as_tibble(train1)
TS2 <- train1 %>%
  mutate(AgeGroup = case_when(
    train1$Age <= 17 ~ "Child",
    train1$Age <= 64 ~ "Adult",
    TRUE ~ "Senior"
  ))
TS2
summary(TS2)

ggplot(TS2, aes(x = AgeGroup ))+ 
  geom_density(aes(fill = Survived), 
               position = "stack")+
  labs(x = "Age Group",
       y = "Density",
       title = "Density Plot",
       subtitle = "Survival Based on Age Group",
       caption = "Grouping ages to handle outliers maintained the distributive properties of the age feature.")+
  theme_minimal()

factor(TS2$AgeGroup)
TS2$AgeGroup <- factor(TS2$AgeGroup) 
  
ggplot(data = train1, aes(x = Age))+ 
  geom_histogram(binwidth = 15, 
                 mapping = aes(fill = Survived))+
  labs(x = "Age of Passengers", 
       y = "Count of Passengers", 
       title = "Histogram of Surviors", 
       subtitle = "By Age",
       caption = "Visual of survivors based on age. Data is right skewed.")+
  theme_minimal()

ggplot(data = train1, aes(x=Age))+ #Visual showing survival facets based on gender and age. 
  geom_bar(mapping = aes(fill = Sex))+
  facet_grid(rows = vars(Pclass),
             cols = vars(Survived), 
             scales = "free", 
             labeller = label_both)+
  labs(x = "Age", 
       y = "Count of Passengers",
       title = "Faceted Bar Graph",
       subtitle = "Based on Survival, Age, and Gender",
       caption = "Visual showing survival facets based on gender and age.")+
  theme_minimal()
```

## Survival by Fare

```{r survival_by_fare, echo=FALSE}

ggplot(train1, aes(x = Fare))+  
  geom_histogram(binwidth = 10, 
                 aes(fill = Survived))+
  labs(x = "Fare",
       title = "Histogram",
       subtitle = "Survival Based on Fare", 
       caption = "Data is right skewed and does not follow a normal distribution")+
  theme_minimal()

ggplot(train1, aes(x = Fare))+ #Density plot showing survival based on fare paid. 
  geom_density(aes(fill = Survived), 
               position = "stack")+
  labs(x = "Fare",
       y = "Density",
       title = "Density Plot",
       subtitle = "Survival Based on Fare")+
  theme_minimal()
```

# Logistic Regression Modeling

```{r logistic_regression_model,echo=TRUE}


# Splitting the data into features (X) and target (y)
X <- train1[, c("PassengerId", "Survived")]
y <- train1$Survived

# Fit a logistic regression model
log_reg_model <- glm(Survived ~ ., data = train1, family = binomial)

# Print the summary of the model
summary(log_reg_model)

```